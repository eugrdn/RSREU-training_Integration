# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ3

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–í –¥–∞–Ω–Ω–æ–π –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ª–∞–±–∞—Ö, –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–æ–º, —Å–µ—Ä–≤–µ—Ä–æ–º –∏ –ë–î.

–î–∞–ª–µ–µ –ø–æ—à–∞–≥–æ–≤–æ –æ–ø–∏—Å–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π, –∞ —Ç.–∂ –ø—Ä–∏–≤–µ–¥–µ–Ω —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞–Ω–∏–π –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º –≤ –∫–æ–Ω—Ü–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

### –®–∞–≥ :one: -- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ MongoDB

–î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–∑–∞–∏–º–Ω—É—é —Ä–∞–±–æ—Ç—É –Ω–∞—à–µ–π –ë–î —Å —Å–µ—Ä–≤–µ—Ä–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π npm-–ø–∞–∫–µ—Ç [**mongodb**](https://www.npmjs.com/package/mongodb), –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –¥—Ä–∞–π–≤–µ—Ä–æ–º [MongoDB](https://www.mongodb.com/) –¥–ª—è [Node.js](https://nodejs.org/en/) –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ API –ø–æ–≤–µ—Ä—Ö mongodb-—è–¥—Ä–∞. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –æ–Ω —É –≤–∞—Å —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –î–ª—è —ç—Ç–æ–≥–æ –∑–∞–≥–ª—è–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª package.json (–æ–±—ä–µ–∫—Ç "_dependencies_"), –µ—Å–ª–∏ –∂–µ –Ω–µ—Ç, –≤–≤–µ–¥–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É

``` js
  npm install --save mongodb
```

–¢–µ–ø–µ—Ä—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç –∫ –ø—Ä–æ–µ–∫—Ç—É. –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –Ω–∞—à–µ–π –ë–î –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤—ã–Ω–µ—Å–µ–º –ª–æ–≥–∏–∫—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –Ω–∏–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å: —Å–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É `./db` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞, –∞ —Ç.–∂ —Ñ–∞–π–ª `index.js` –≤ –Ω–µ–π.

–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é –Ω–∞–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Å –ø–æ–º–æ—â—å—é –ø–æ–¥—Ö–æ–¥–∞ CommonJS (—Ñ—É–Ω–∫—Ü–∏–∏ _required_). –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –Ω–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç –æ–±—ä–µ–∫—Ç [MongoClient](https://www.npmjs.com/package/mongodb#connecting-to-mongodb), –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª–∏—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î, –∞ –∑–∞—Ç–µ–º –ø—Ä–∏ –µ–µ —É—Å–ø–µ—à–Ω–æ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç –ë–î. 

–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –∫–æ–¥ –º–æ–¥—É–ª—è, –∫–æ—Ç–æ—Ä—ã–π —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥ **connect**, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ä -- –ø—É—Ç—å –∫ –ë–î, –∑–∞—Ç–µ–º –ø—Ä–æ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, –∏ –∫–ª–∞–¥–µ—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é _db –æ–±—ä–µ–∫—Ç –ë–î, –µ—Å–ª–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –ø–µ—Ä–µ–¥–∞–µ—Ç –æ—à–∏–±–∫—É. –ü–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ –≤ —Å–≤–æ–π –º–æ–¥—É–ª—å.

``` js
const MongoClient = require('mongodb').MongoClient;
let _db = null;

module.exports = {
  connect(url) {
    return MongoClient.connect(url)
      .then(db => (_db = db))
      .catch(err => Promise.reject(err));
  },
};
```

>**–í–∞–∂–Ω–æ!** –í –¥–∞–Ω–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º [_Promise_](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise), —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î. 
**Promise** ‚Äì —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ä–æ–Ω–Ω—ã–º–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ (–ø–æ—Ö–æ–∂–µ –Ω–∞ Futures –≤ Java). –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –æ—Ç –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∫ –¥—Ä—É–≥–æ–º—É —É Promise –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á–µ–π–Ω–∏–Ω–≥ _–ø—Ä–∏–º._ `...then(...).then(...)`. –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–ª–µ–µ –≤ –ª–∞–±–æ—Ç–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç–µ.

–û—Ç–ª–∏—á–Ω–æ, —Ç–µ–ø–µ—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è _db —Ö—Ä–∞–Ω–∏—Ç –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ù–æ —Å–µ–π—á–∞—Å –æ–Ω –Ω–µ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω, —Ç.–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–∫—É—â–µ–º –º–æ–¥—É–ª–µ. –¶–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –±—É–¥–µ—Ç –Ω–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—ã –æ—Ç–¥–∞–≤–∞–ª –Ω–∞–º —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç. 

#### –ó–∞–¥–∞–Ω–∏–µ 1.1 
>–ù–∞–ø–∏—à–∏—Ç–µ –º–µ—Ç–æ–¥ `getInstance` (–ø–æ –ø—Ä–∏–º–µ—Ä—É `#connect`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –ë–î, –µ—Å–ª–∏ —Ç–æ—Ç –∏–º–µ–µ—Ç—Å—è, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, —á—Ç–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ.

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–æ–±–∞–≤–∏–º —Ç.–∂ –º–µ—Ç–æ–¥ `getCollection`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ë–î, –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—ä–µ–∫—Ç —ç—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ -- –æ—à–∏–±–∫–∞ –æ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.

```js
module.exports = {
  ...
  getCollection(name) {
    const collection = this.getInstance().collection(name);
    
    if (!collection) {
      throw Error(`Requested Collection "${name}" not found!`);
    }
    return collection;
  }
}
```

–®–∞–≥ 1 –ø–æ—á—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω, –æ—Å—Ç–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∞–º–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—à –º–æ–¥—É–ª—å db. –ü–µ—Ä–µ–π–¥–µ–º –≤ —Ñ–∞–π–ª "server.js", –ø–æ–¥–∫–ª—é—á–∏–º –Ω–∞—à –º–æ–¥—É–ª—å, –∞ —Ç.–∂ –∑–∞–¥–∞–¥–∏–º **URL** –Ω–∞—à–µ–π –ë–î –≤ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–µ.

```js
const MongoDB = require('./db');
const DB_URL = 'mongodb://localhost:27017/library';
```

–î–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ –º–µ—Ç–æ–¥ **connect** —É—Å—Ç–∞–Ω–æ–≤–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î, –µ—Å–ª–∏ –≤—Å–µ —É—Å–ø–µ—à–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º .then –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é —á–∞—Å—Ç—å, –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã–≤–æ–¥–∏–º –æ—à–∏–±–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É.

```js
// –∏–º–ø–æ—Ä—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
...

MongoDB.connect(DB_URL)
  .then(() => {
    console.log(`Connected succsessfully!`);
    // –∫–æ–¥ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏
    ...
  })
  .catch(err => console.log(`An error with connection to db ${err}!`));
```

### –®–∞–≥ :two: -- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

–í –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞—Ö –≤–∞–º–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É—Ç–µ–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API (`./api/...`). –°–µ–π—á–∞—Å –æ–Ω–∏  –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ù–∞—à–∞ –∑–∞–¥–∞—á–∞ -- —Å–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø –∫ –æ–±—ä–µ–∫—Ç—É –ë–î –∏ –≤—ã—Ç–∞—Å–∫–∏–≤–∞—Ç—å –∏–∑ –Ω–µ–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ, —Å–æ–≥–ª–∞—Å–Ω–æ –∑–∞–ø—Ä–æ—Å–∞–º —Å –∫–ª–∏–µ–Ω—Ç–∞.

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∫–Ω–∏–≥.

–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É `./services`, –∏ —Ñ–∞–π–ª `book.service.js`. 
–ü–æ–ª—É—á–∏–º –æ–±—ä–µ–∫—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ "books" –∏–∑ –Ω–∞—à–µ–π –ë–î `./db/index.js` —Å –ø–æ–º–æ—â—å—é #getCollection –∏ –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∑–∞–ø–∏—à–µ–º –µ–≥–æ –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é. 

```js
const bookCol = require('../db').getCollection('books');
```

–î–∞–ª–µ–µ —Å–æ–∑–¥–∞–¥–∏–º –æ–±—ä–µ–∫—Ç —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –±—É–¥–µ—Ç –ø–æ–ø–æ–ª–Ω—è—Ç—å—Å—è –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î, –∞ —Ç.–∂ –≤—ã–ø–æ–ª–Ω–∏–º –µ–≥–æ `export`. –ù–∞ –ø—Ä–∏–º–µ—Ä–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∫–Ω–∏–≥ - **GET /api/books** –Ω–∞–ø–∏—à–µ–º –º–µ—Ç–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ API:

```js
const service = {
  getBooks() {
    return bookCol.find({}).toArray();
  },
};

module.exports = service;
```

–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é _mongodb_ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ mongo-shell, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –ª–∞–±–µ. –û–¥–Ω–∞–∫–æ, –≤—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å –º–µ—Ç–æ–¥ "**toArray**". –î–µ–ª–æ –≤ —Ç–æ–º, —á—Ç–æ –º–µ—Ç–æ–¥ find –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ –¥–∞–Ω–Ω—ã–µ, –∞ –æ–±—ä–µ–∫—Ç _Cursor_ - —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é –∑–∞–ø—Ä–æ—Å–∞. –ù–æ –Ω–∞–º –Ω—É–∂–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∞ –Ω–µ —É–∫–∞–∑–∞—Ç–µ–ª—å. –î–ª—è —ç—Ç–æ–≥–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ "toArray".

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ cursor –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [–∑–¥–µ—Å—å](https://docs.mongodb.com/manual/reference/method/js-cursor/), –∞ –ø—Ä–æ –º–µ—Ç–æ–¥ toArray [–∑–¥–µ—Å—å](https://docs.mongodb.com/manual/reference/method/cursor.toArray/index.html).


> **–í–∞–∂–Ω–æ!** –î—Ä–∞–π–≤–µ—Ä mongodb –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2 –≤–∏–¥–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏:
>* `callback`, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π –≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º—É—é —Ñ—É–Ω–∫—Ü–∏—é
>* –≤–æ–∑–≤—Ä–∞—â–∞—è `Promise` –∏–∑ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
>
>–í—ã–ø–æ–ª–Ω—è—è –∑–∞–ø—Ä–æ—Å –∫ –ë–î –º—ã —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é. –†–∞–Ω–µ–µ –≤ —ç—Ç–æ–π –ª–µ–∫—Ü–∏–∏ –ø—Ä–∏–≤–æ–¥–∏–ª–æ—Å—å –æ–ø–∏—Å–∞–Ω–∏–µ —É–¥–æ–±–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è Promise –∏—Å–ø–æ–ª—å–∑—É—è _chaining_, –¥–∞–ª–µ–µ –≤ –ø—Ä–∏–º–µ—Ä–µ, –º—ã –≤—ã–∑—ã–≤–∞–µ–º **.then()** —É –º–µ—Ç–æ–¥–∞ _getAllBooks_, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –º–µ—Ç–æ–¥ _toArray_, –Ω–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞, –≤–µ—Ä–Ω—É–ª Promise —Å –¥–∞–Ω–Ω—ã–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∫–∞–∫ —Ä–∞–∑ —É–¥–æ–±–Ω–æ –ø–æ–ª—É—á–∞–µ–º –≤ —Å–ª–µ–¥—É—â–µ–º **.then()**. –ü–æ—Å–ª–µ —á–µ–≥–æ –≤—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ __send__ –æ–±—ä–µ–∫—Ç–∞ response, –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç.

–î–∞–ª–µ–µ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à —Å–µ—Ä–≤–∏—Å –≤ —Ñ–∞–π–ª —Å API –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –ø–æ-–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:

```js
...
const bookService = require('../services/book.service');

router
  .get('/books', (req, res) => {
      service.getAllBooks()
        .then(data => res.send(data))
        .catch(err => res.send(err));
  })
  ...
```

–û—Ç–ª–∏—á–Ω–æ! –£ –Ω–∞—Å –Ω–∞–ø–∏—Å–∞–Ω —Å–µ—Ä–≤–∏—Å –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∫–Ω–∏–∂–µ–∫. –ù–æ —ç—Ç–æ –µ—â–µ –Ω–µ –≤—Å–µ :grimacing:

–ù–∞ –Ω–∞—à–µ–º –∫–ª–∏–µ–Ω—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∏–º–µ—é—â–∏—Ö—Å—è –∫–Ω–∏–∂–µ–∫. –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –º—ã —Ç–∞–∫ –∂–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –Ω–∞—à–µ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∫–æ–ª–ª–µ–∫—Ü–∏–π _–§–∏–ª—å—Ç—Ä–æ–≤_ –∏ _–ö–∞—Ç–µ–≥–æ—Ä–∏–π_ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

#### üé≠ –ó–∞–¥–∞–Ω–∏—è –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
#### –ó–∞–¥–∞–Ω–∏–µ 2.1
>–ü–æ –ø—Ä–∏–º–µ—Ä—É —Å–æ–∑–¥–∞–Ω–∏—è _bookService_, –Ω–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–∏—Å –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏:
>* "categories" -- —á–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
>* "filters" -- –Ω–µ—á–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
>
>–∫–æ—Ç–æ—Ä—ã–π –±—É–¥—É—Ç –∏–º–µ—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `getAll(Categories|Filters)` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º —Ä—É—á–∫–∞–º —Ä–æ—É—Ç–µ—Ä–∞.

P.S. —Ç.–∫ —ç—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∫–∞–∂–¥–æ–º—É, –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ –¥—Ä—É–≥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–∂–Ω–æ —Å—Ç–∞—â–∏—Ç—å —É —Å–æ—Å–µ–¥–∞ :poop:, –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∞–º–æ–º—É :thumbsup:. 

### –®–∞–≥ :three: -- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –§–∏–ª—å—Ç—Ä—ã
–ö–∞–∫ –≤—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å, –Ω–∞ –Ω–∞—à–µ–º –∫–ª–∏–µ–Ω—Ç–µ –∏–º–µ–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–≤–µ—Å—Ç–∏ —á—Ç–æ-–ª–∏–±–æ –≤ —Å—Ç–æ–∫—É –ø–æ–∏—Å–∫–∞, –≤—ã–±—Ä–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä. –ß—Ç–æ–±—ã —Å–æ–æ–±—â–∏—Ç—å —Å–µ—Ä–≤–µ—Ä—É –æ —Ç–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö, –∫–ª–∏–µ–Ω—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ GET-–∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ URI —Ä–µ—Å—É—Ä—Å–∞ –ø–æ—Å–ª–µ —Å–∏–º–≤–æ–ª–∞ `?`. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Å—Ç—Ä–æ–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ —è–≤–ª—è—é—Ç—Å—è:
* `search` -- —Å–∏–º–≤–æ–ª—ã —Å—Ç—Ä–æ–∫–∏ –ø–æ–∏—Å–∫–∞
* `activeFilter` -- id –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞
* `activeCategory` -- id –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

–ö–∞–∂–¥—ã–π –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–±—Ä–∞–Ω/–≤–≤–µ–¥–µ–Ω, –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –æ–Ω –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞ –≤ Express.js –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `.get('/', (reqest, response) => ...)`, –∞ –∏–º–µ–Ω–Ω–æ –µ–≥–æ —Å–≤–æ–π—Å—Ç–≤–æ .query.

>**–í–∞–∂–Ω–æ!** –ù–µ –ø—É—Ç–∞—Ç—å request.**query** –∏ request.**params**:
>* params 
>
>       GET /api/books/1
>       app.get('/books/:id', (reqest, response)=>...)
>
>       request.params.id // 1
>
> * query
>
>       GET /api/books?search='Figth Club'
>       app.get('/books', (reqest, response)=>...)
>
>       request.query.search // Figth Club

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ _query_ [–∑–¥–µ—Å—å](http://expressjs.com/ru/api.html#req.query), –æ _params_ [—Ç—É—Ç](http://expressjs.com/ru/api.html#req.params).

–ù–∞ –ø—Ä–∏–º–µ—Ä–µ, –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ —Ä–∞–Ω–µ–µ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –∫–Ω–∏–≥ `GET /api/books`, –¥–æ–±–∞–≤–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤—ã–±–æ—Ä–∫–∏ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –∑–∞–ø—Ä–æ—Å GET –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, —Ç.–µ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–¥–Ω–æ –∏–∑ –≤–æ–∑–º–æ–∂–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å 2^3 –ø—Ä–æ–≤–µ—Ä–æ–∫ (–∫–∞–∂–¥—ã–π —Ñ–∏–ª—å—Ç—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, —Ç–∞–∫ –∏ –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω -- –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è).
–î–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –±–æ–ª—å—à–æ–≥–æ boilerplate –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Å–µ—Ö —É—Å–ª–æ–≤–∏–π, —Ä–µ–∞–ª–∏–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é-—É—Ç–∏–ª–∏—Ç—É, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–∞–∂–¥–æ–º—É –∏–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤. –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–µ —É–∫–∞–∑–∞–Ω -- –æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É.

>**–í–∞–∂–Ω–æ!** –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ —Ñ–∏–ª—å—Ç—Ä–∞ –≤ —Å—Ç—Ä–æ–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é id-—à–Ω–∏–∫–æ–≤. –ù–∞–º –∂–µ –±—É–¥–µ—Ç —É–¥–æ–±–Ω–µ–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å _—Ç–∏–ø–∞–º–∏_, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –≤ –Ω–∞—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–∞–∂–¥–æ–º –∏–∑ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ –ø–æ–ª—É—á–µ–Ω–∏—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –ø–æ –∏–∑–≤–µ—Å—Ç–Ω–æ–º—É id.

#### üé≠ –ó–∞–¥–∞–Ω–∏—è –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º
#### –ó–∞–¥–∞–Ω–∏–µ 3.1
> –ù–∞–ø–∏—Å–∞—Ç—å –º–µ—Ç–æ–¥:
>* `getCategoryById` -- —á–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
>* `getFilterById` -- –Ω–µ—á–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
>
> –≤ categoryService –∏ filterService —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
>
>P.S. (—Å–Ω–æ–≤–∞) —Ç.–∫ —ç—Ç–∏ –º–µ—Ç–æ–¥—ã –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∫–∞–∂–¥–æ–º—É, –∫–æ–¥ –º–µ—Ç–æ–¥–∞ –¥—Ä—É–≥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –º–æ–∂–Ω–æ —Å—Ç–∞—â–∏—Ç—å —É —Å–æ—Å–µ–¥–∞ :poop:, –∏–ª–∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–∞–º–æ–º—É :thumbsup:. 

–î–∞–ª–µ–µ –∑–∞–ø–∏—à–µ–º –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é:
```js
.get('/books', (req, res) => {
  const {search, activeFilter, activeCategory} = req.query;

  Promise.all([
    filterService.getFilterById(+activeFilter),
    categoryService.getCategoryById(+activeCategory)
  ])
    .then(([filter, category]) => {
        // –ø–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–¥
    })
    .catch(err => res.send(err));
})
```
–ó–¥–µ—Å—å –º—ã –≤—ã–ø–æ–ª–Ω—è–µ–º 2 –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î, –∏ –¥–æ–∂–¥–∞–≤—à–∏—Å—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç –æ–±–æ–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –¥–∞–ª–µ–µ. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ _Promise.all_ [–∑–¥–µ—Å—å](https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Promise/all).

> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –∑–Ω–∞–∫ "+" —Ä—è–¥–æ–º —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö id. –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏ _**get...ById**_ –∫ —Ç–∏–ø—É **Number**, —Ç.–∫ —Å—Ö–µ–º—ã `mongodb` –æ–±—ä–µ–∫—Ç–æ–≤ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ç–∏–ø–∞–º, –∏ –æ–ø—É—Å—Ç–∏–≤ —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é –º—ã –±—É–¥–µ–º –∏—Å–∫–∞—Ç—å id, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π —Å—Ç—Ä–æ–∫–æ–≤—ã–º —Ç–∏–ø–æ–º, —Ö–æ—Ç—è –≤ –Ω–∞—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö –æ–Ω —Ç–∏–ø–∞ Number.

–í–µ—Ä–Ω–µ–º—Å—è –∫ –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏-—É—Ç–∏–ª–∏—Ç–µ...

–°–æ–∑–¥–∞–¥–∏–º –ø–∞–ø–∫—É `./utils` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Ñ–∞–π–ª `meet-query.utils.js`. –ö–æ–¥ –¥–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è –ø—Ä–∏–≤–¥–µ–Ω –Ω–∏–∂–µ.

```js 
function meetQuery({book, search, filter, category}) {
  const expectations = [
    meetSearch(search),
    meetFilter(filter),
    meetCategory(category)
  ];

  return expectations.filter(f => f(book)).length === expectations.length;
}

function meetSearch(queryString) {
  return book =>
    queryString
      ? queryString.includes(book.title) || queryString.includes(book.author)
      : true;
}

function meetFilter(filter) {
  return book => {
    // TODO
  };
}

function meetCategory(category) {
  return book => (category ? book.categories.includes(category.type) : true);
}

module.exports = meetQuery;
```
–ó–¥–µ—Å—å, –≤ —Ñ—É–∫–Ω–∫—Ü–∏–∏ meetQuery, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª–∏ –æ–±—ä–µ–∫—Ç "book" –∫–∞–∂–¥–æ–º—É –∏–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤ (—Å—Ç—Ä–æ–∫–µ –ø–æ–∏—Å–∫–∞, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –∏ —Ñ–∏–ª—å—Ç—Ä–∞–º). –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç—Ä–æ–∫–µ –ø–æ–∏—Å–∫–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —É–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä–∫—É –ø–æ "—Ñ–∏–ª—å—Ç—Ä–∞–º" –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å –í–∞–º —Å–∞–º–∏–º.

#### –ó–∞–¥–∞–Ω–∏–µ 3.2
>–ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—ä–µ–∫—Ç–∞ –∫–Ω–∏–≥–∏ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—É—á–µ–Ω–Ω–æ–º—É —Ñ–∏–ª—å—Ç—Ä—É.

–î–∞–ª–µ–µ –≤—ã–ø–æ–ª–Ω–∏–º –∏–º–ø–æ—Ä—Ç –Ω–∞—à–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ `api/index.js`, –∏ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –Ω–∞—à–µ–≥–æ GET –∑–∞–ø—Ä–æ—Å–∞, –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–ª—É—á–∏–≤ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥, –ø—Ä–æ–≤–µ—Ä–∏–º –∫–∞–∂–¥—É—é –∏–∑ –Ω–∏—Ö —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–π —Å—É–ø–µ—Ä-—É—Ç–∏–ª–∏—Ç—ã :rocket::

```js
 bookService
  .getAllBooks()
  .then(data => {
    const requiredBooks = data.filter(book =>
      meetQuery({book, search, filter, category})
    );

    return res.send(requiredBooks);
  })
  .catch(err => res.send(err));
```

>P.S. –î–∞–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º, –ø–æ—Å–∫–æ–ª—å–∫—É –∫–∞–∂–¥—ã–π —Ä–∞–∑ –º—ã –ø–æ–ª—É—á–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–Ω–∏–≥. –ü–æ–¥—É–º–∞–π—Ç–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –µ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å.

–û—Ç–ª–∏—á–Ω–æ, —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞—à—É –∫–æ–ª–ª–µ–∫—Ü–∏—é! –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å –∑–∞–∫–æ–Ω—á–µ–Ω–∞. –î–∞–ª–µ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–µ.

## –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ POST-–∑–∞–ø—Ä–æ—Å–∞ `/api/book` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ `action` –≤–∞—à–µ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞.

>**–í–∞–∂–Ω–æ!** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ POST-–∑–∞–ø—Ä–æ—Å–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (–æ–±—ä–µ–∫—Ç **request.body**). –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ POST –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å [–∑–¥–µ—Å—å](https://ru.wikipedia.org/wiki/POST_(HTTP)).

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —É–∫–∞–∑–∞–Ω–∞ **—Å—Ö–µ–º–∞ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞**.

–û—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç **–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥**, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–π —Ñ–∏–ª—å—Ç—Ä–∞–º, —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞.

>P.S. –ü–∞—Ä–∞–º–µ—Ç—Ä id, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–¥–∞–µ—Ç—Å—è —Å –∫–ª–∏–µ–Ω—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —à–µ—Å—Ç–Ω–∞–¥—Ü–∞—Ç–µ—Ä–∏—á–Ω—ã–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π MongoDB –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä–µ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –î–ª—è –≤—ã–±–æ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∫–Ω–∏–≥–∏ –ø–æ —Ç–∞–∫–æ–º—É id –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –±—É–¥–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é _.ObjectId_ –∏–∑ –ø–∞–∫–µ—Ç–∞ `mongodb`, –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –∫–∞–∫ –æ–±–µ—Ä—Ç–∫—É –Ω–∞–¥ –ø—Ä–∏–Ω—è—Ç—ã–º id, –ø—Ä–∏–º. `{"_id": ObjectId(id)}`. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± [ObjectId](https://docs.mongodb.com/manual/reference/method/ObjectId/).

#### –í–∞—Ä–∏–∞–Ω—Ç 1. CREATE
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ (–∫–Ω–æ–ø–∫–∞ ADD A BOOK).
```js
// schema
{
  action: 'create',
  search: string | undefined,
  activeFilter: string | undefined,
  activeCategory: string | undefined,
  book: {
    title: string,
    author: string,
    categories: string[],
    img: string
  }
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2. UPDATE
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫–Ω–∏–≥–∏ (–∫–ª–∏–∫ –Ω–∞ –∑–≤–µ–∑–¥—ã –ø–æ–¥ –∫–Ω–∏–≥–æ–π).
```js
// schema
{
  action: 'update',
  search: string | undefined,
  activeFilter: string | undefined,
  activeCategory: string | undefined,
  id: string,
  rating: number
}
```

#### –í–∞—Ä–∏–∞–Ω—Ç 3. DELETE 
–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ (–∫–ª–∏–∫ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫, –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –º—ã—à–∏ –Ω–∞ –∫–Ω–∏–≥—É).
```js
// schema
{
  action: 'delete',
  search: string | undefined,
  activeFilter: string | undefined,
  activeCategory: string | undefined,
  id: string,
}
```

<p align="center">
  The End.
</p>

<p align="center">
  :tada:
</p>

